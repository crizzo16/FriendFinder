<!DOCTYPE <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>FriendFinder</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Boogaloo|Montserrat" rel="stylesheet">
    <!-- Latest compiled and minified CSS & JS  for Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <!-- My stylesheets -->
    <link rel="stylesheet" type="text/css" href="/CSS/reset.css">
    <link rel="stylesheet" type="text/css" href="/CSS/style.css">
    <link rel="shortcut icon" href="/Images/favicon.ico?v=2" type="image/x-icon">
</head>

<body>
    <!-- Modal copied from Bootstrap documentation -->
    <div class="modal fade" id="friendModal" tabindex="-1" role="dialog" aria-labelledby="friendModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bestMatch">Best Match</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- This is what gets replaced once a friend has been found-->
                    <h3 id="friendName"></h3><br>
                    <img class="modal-img" alt="closest friend image" id="friendImg">
                </div>
            </div>
        </div>
    </div>

    <div class="jumbotron mb-4">
        <h1 class="display-4" id="title">FriendFinder</h1>
        <hr class="my-4">
        <p class="mt-4 mb-4" id="tagline">Survey Questions</p>
    </div>

    <div class="container">
        <!-- Survey form -->
        <form class="form-flex">
            <div class="card form-group wide-form">
                <div class="card-header">
                    <h2>About You</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="picURL">URL of Picture</label>
                        <input type="text" id="picURL" class="form-control">
                    </div>
                </div>
            </div>

            <div class="card form-group">
                <div class="card-header">
                    <h3>You often get so lost in thoughts that you ignore or forget your surroundings.</h3>
                </div>
                <div class="card-body">
                    <select id="a" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>You find it difficult to introduce yourself to other people.</h3>
                </div>
                <div class="card-body">
                    <select id="b" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>You find it easy to stay relaxed even when there is some pressure.</h3>
                </div>
                <div class="card-body">
                    <select id="c" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>You do not usually initiate conversations.</h3>
                </div>
                <div class="card-body">
                    <select id="d" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>You rarely do something out of curiosity.</h3>
                </div>
                <div class="card-body">
                    <select id="e" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Being organized is more important to you than being adaptable.</h3>
                </div>
                <div class="card-body">
                    <select id="f" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>You are usually highly motivated and energetic.</h3>
                </div>
                <div class="card-body">
                    <select id="g" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Winning a debate matters less to you than making sure no one gets upset.</h3>
                </div>
                <div class="card-body">
                    <select id="h" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>You consider yourself more practical than creative.</h3>
                </div>
                <div class="card-body">
                    <select id="i" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>It is often difficult for you to relate to other people's feelings.</h3>
                </div>
                <div class="card-body">
                    <select id="j" class="select-style form-control">
                        <option value=1>1 (Strongly Disagree)</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5 (Strongly Agree)</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-blue btn-lg btn-wide submit">Submit</button>
        </form>
    </div>




    <!-- Javascript for properly submitting the data -->
    <script type="text/javascript">
        // Submitting the form
        $(".submit").on("click", function (event) {
            // Stop the form from going to a new page
            event.preventDefault();

            // Format the data
            let person = {
                name: $("#name").val().trim(),
                picURL: $("#picURL").val().trim(),
                scores: [parseInt($("#a").val()), parseInt($("#b").val()), parseInt($("#c").val()), parseInt($("#d").val()), parseInt($("#e").val()), parseInt($("#f").val()), parseInt($("#g").val()), parseInt($("#h").val()), parseInt($("#i").val()), parseInt($("#j").val())]
            };

            // Console log the data to make sure it's format correctly
            // console.log(person);

            // Post the data to the server
            $.post("/api/friends", person, function (data) {
                // Get the entire friends array
                $.ajax({ url: "/api/friends", method: "GET" }).then(function (friendz) {
                    // Check to make sure all friends have been grabbed (only do this for small arrays)
                    //console.log(friendz);
                    //console.log("******************************");

                    // Initialize checks to find closest friend
                    let score = 100; // It's not possible to have a score of 100, so the first option will definitely be smaller
                    let index = 0; // At the very least, you'll have one friend

                    // Loop through the friends to find the **BEST** friend
                    for (let m = 0; m < (friendz.length - 1); m++) {
                        // The score for this specific friend 
                        let compare = 0;
                        // Loop through this friend's scores
                        for (let x = 0; x < friendz[m].scores.length; x++) {
                            compare += Math.abs(person.scores[x] - friendz[m].scores[x]);
                        }
                        // If this score is lower (i.e. closer) go with that person
                        if (compare < score) {
                            score = compare;
                            index = m;
                        }
                    }
                    // Log the closet friend ( debugging purposes)
                    // console.log("friend: " + friendz[index].name);

                    // Set the modal fields
                    $("#friendName").text(friendz[index].name);
                    $("#friendImg").attr("src", friendz[index].picURL);
                    // Show the modal
                    $('#friendModal').modal('show');

                    // Reset form
                    $("#name").val("");
                    $("#picURL").val("");
                    $("#a").selectedIndex = 0;
                    $("#b").selectedIndex = 0;
                    $("#c").selectedIndex = 0;
                    $("#d").selectedIndex = 0;
                    $("#e").selectedIndex = 0;
                    $("#f").selectedIndex = 0;
                    $("#g").selectedIndex = 0;
                    $("#h").selectedIndex = 0;
                    $("#i").selectedIndex = 0;
                    $("#j").selectedIndex = 0;
                });
            });
        });
    </script>
</body>

</html>